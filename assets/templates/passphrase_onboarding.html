<!DOCTYPE html>
<html lang="{{.Locale}}">

<head>
    <meta charset="utf-8">
    <title>Cozy</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{asset .Domain "/fonts/fonts.css"}}">
    <link rel="stylesheet" href="{{asset .Domain "/styles/login.css"}}">
    <link rel="icon" type="image/png" href="{{asset .Domain "/images/happycloud.png"}}" />
    <link rel="shortcut icon" type="image/x-icon" href="{{asset .Domain "/favicon.ico"}}">
</head>

<body>
    <div class="main-wrapper">
        <main role="application">
            <section class="popup">
                <header>
                    <a href="https://cozy.io" target="_blank" title="Cozy Website" class="shield"></a>
                    <h1>{{t "Passphrase Onboarding Title"}}</h1>
                </header>
                <div role="region">
                    <form id="password-form" method="POST" action="/settings/passphrase" onsubmit="submitform(event)">
                        <p class="line"></p>
                        <input type="hidden" name="register_token" value={{.RegisterToken}}>
                        <input type="password" name="passphrase" autocomplete="new-password" placeholder='e.g. "dEj875ghj9273;eR"'><br><br>
                        <input type="submit" class="next" value={{t "Passphrase Onboarding Submit"}}>
                    </form>
                </div>
            </section>
        </main>
    </div>
</body>
<script type="text/javascript">
    function submitform(e) {
        e.preventDefault();
        var ab = document.getElementById("password-form");
        var formData = new FormData(ab)

        var object = {};
        formData.forEach(function (value, key) {
            object[key] = value;
        });
        var json = JSON.stringify(object);

        var xhr = new XMLHttpRequest();
        xhr.open(ab.method, ab.action, false);
        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
        xhr.send(json);

        var onboarded = new XMLHttpRequest();
        onboarded.open("GET", "/settings/onboarded", true)
        onboarded.send();

        return false;
    }
</script>

</html>
